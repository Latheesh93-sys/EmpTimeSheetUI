<div class="container py-4">
  <div class="card shadow-sm" *ngIf="user.designation!='Manager'&&user.designation!='Admin'">
    <div class="card-body">
      <h3 class="card-title mb-3">Add Timesheet</h3>

      <form [formGroup]="timesheetForm" (ngSubmit)="saveTimesheet()">
        <div class="row g-3">
            <!-- Project -->
            <div class="col-md-3">
            <label class="form-label">Select Project:</label>
            <ng-select
            [items]="projects"
            bindLabel="name"
            bindValue="id"
            formControlName="projectId"
            placeholder="Select Project"
            [searchable]="true"
            [clearable]="true"
            class="w-100">
          </ng-select>
          </div>
          <!-- Date -->
          <div class="col-md-3">
            <label class="form-label">Date:</label>
            <input type="date" formControlName="workDate" class="form-control" />
            <div *ngIf="timesheetForm.get('workDate')?.touched && timesheetForm.get('workDate')?.invalid" class="text-danger small mt-1">
                Date is required 
          </div>
          </div>
        <!-- Hours Worked -->
          <div class="col-md-3">
            <label class="form-label">Hours Worked:</label>
            <input type="number" formControlName="hoursWorked" class="form-control" placeholder="Enter hours worked" />
            <div *ngIf="timesheetForm.get('hoursWorked')?.touched && timesheetForm.get('hoursWorked')?.invalid" class="text-danger small mt-1">
              Hours worked is required
            </div>
          </div>
          <!-- Description -->
          <div class="col-md-6">
              <textarea formControlName="description" class="form-control" rows="4" placeholder="Enter description"></textarea>
              <div *ngIf="timesheetForm.get('description')?.invalid && timesheetForm.get('description')?.touched" class="text-danger">
              Description is required and max 500 characters.
          </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="mt-4 text-end">
          <button type="submit" class="btn btn-primary" [disabled]="isLoading || timesheetForm.invalid">
            <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
            Add
          </button>
        </div>
      </form>
    </div>
  </div>
  <br>
  <div class="card shadow-sm">
    <div class="card-body">
      <h3 class="card-title mb-3">Timesheet List</h3>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-dark">
            <tr>
              <th>Project</th>
              <th>Employee</th>
              <th>Date</th>
              <th>Hours Worked</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tsheet of timesheets">
              <td>{{tsheet.projectName }}</td>
              <td>{{tsheet.employeeName }}</td>
              <td>{{tsheet.date| date:'dd-MMM-yyyy' }}</td> 
              <td>{{tsheet.hoursWorked}}</td>
              <td>{{tsheet.description}}</td>
              <td *ngIf="(user.designation!='Admin'&&user.designation!='Manager')||(user.designation==='Manager'&& tsheet.isApproved==true)">
                {{ tsheet.isApproved ? 'Approved' : 'Pending' }}
              </td>
              <td *ngIf="user.designation==='Manager'&& tsheet.isApproved==false">
                <button class="btn btn-primary" (click)="approveTimeSheet(tsheet)">
                  <span *ngIf="isApproving" class="spinner-border spinner-border-sm me-2"></span>
                  Approve</button>
              </td>
            </tr>
            <tr *ngIf="timesheets.length === 0">
              <td colspan="4" class="text-center text-muted py-3">No timesheets found</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>